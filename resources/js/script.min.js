/**
 * Icon Captcha Plugin: v2.2.0
 * Copyright Â© 2017, Fabian Wennink (https://www.fabianwennink.nl)
 *
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
!function(a){a.fn.extend({iconCaptcha:function(c){var t={captchaTheme:[""],captchaFontFamily:"",captchaClickDelay:1e3,captchaHoverDetection:!0,showCredits:!0,enableLoadingAnimation:!1,loadingAnimationDelay:2e3,requestIconsDelay:1500,captchaAjaxFile:"../php/captcha-request.php",captchaMessages:{header:"Select the image that does not belong in the row",correct:{top:"Great!",bottom:"You do not appear to be a robot."},incorrect:{top:"Oops!",bottom:"You've selected the wrong image."}}},e=a.extend(t,c);return this.each(function(c){function t(a){var c="light";void 0==e.captchaTheme[g]||"dark"!==e.captchaTheme[g]&&"light"!==e.captchaTheme[g]||(c=e.captchaTheme[g].toLowerCase()),_=0,m.addClass("captcha-theme-"+c),f||o();var t=m.find(".captcha-modal__icons");e.requestIconsDelay&&e.requestIconsDelay>0&&!f?(a||r(t),setTimeout(function(){i(c,t,!0)},e.requestIconsDelay)):i(c,t,a)}function i(t,i,o){a.ajax({url:e.captchaAjaxFile,type:"post",data:{cID:g,rT:1,tM:t},success:function(t){t&&($data=JSON.parse(t),o||r(i),u=new Date,m.find(".captcha-image").each(function(c,t){a(this).css("background-image","url("+e.captchaAjaxFile+"?cid="+g+"&hash="+$data[c]+")"),a(this).attr("icon-hash",$data[c]),d(a(this),i)}),f||m.trigger("init",[{captcha_id:c}]),f=!0)},error:function(a,c,t){console.log(c,t),h()}})}function o(){e.captchaFontFamily?m.css("font-family",e.captchaFontFamily):a("body").append('\x3c!-- Icon Captcha default font --\x3e<link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">'),m.html(["<div class='captcha-modal'>","<div class='captcha-modal__header'>","<span>"+(e.captchaMessages.header&&e.captchaMessages.header?e.captchaMessages.header:"Select the image that does not belong in the row")+"</span>","</div>","<div class='captcha-modal__icons'>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","</div>","<div class='captcha-modal__credits' alt='IconCaptcha by Fabian Wennink' title='IconCaptcha by Fabian Wennink'>","<a href='https://www.fabianwennink.nl/projects/IconCaptcha/v2/' target='_blank' rel='follow'>IconCaptcha</a> &copy;","</div>","<input type='hidden' name='captcha-hf' required />","<input type='hidden' name='captcha-idhf' value='"+g+"' required />","</div>"].join("\n")).attr("data-captcha-id",g)}function s(c){var t=c.attr("icon-hash");t&&(m.find('input[name="captcha-hf"]').attr("value",t),m.find('input[name="captcha-idhf"]').attr("value",g),a.ajax({url:e.captchaAjaxFile,type:"post",data:{cID:g,pC:t,rT:2},success:function(a){"1"===a?n():h()},error:function(a,c,t){h()}}))}function n(){m.find(".captcha-modal__icons").empty(),m.addClass("captcha-success"),m.find(".captcha-modal__icons").html('<div class="captcha-modal__icons-title">'+(e.captchaMessages.correct&&e.captchaMessages.correct.top?e.captchaMessages.correct.top:"Great!")+'</div><div class="captcha-modal__icons-subtitle">'+(e.captchaMessages.correct&&e.captchaMessages.correct.bottom?e.captchaMessages.correct.bottom:"You do not appear to be a robot.")+"</div>"),m.trigger("success",[{captcha_id:g}])}function h(){m.find(".captcha-modal__icons").empty(),m.addClass("captcha-error"),m.find(".captcha-modal__icons").html('<div class="captcha-modal__icons-title">'+(e.captchaMessages.incorrect&&e.captchaMessages.incorrect.top?e.captchaMessages.incorrect.top:"Oops!")+'</div><div class="captcha-modal__icons-subtitle">'+(e.captchaMessages.incorrect&&e.captchaMessages.incorrect.bottom?e.captchaMessages.incorrect.bottom:"You've selected the wrong image.")+"</div>"),m.trigger("error",[{captcha_id:g}]),setTimeout(p,3e3)}function p(){m.removeClass("captcha-error"),m.find("input[name='captcha-hf']").attr("value",null),m.find(".captcha-modal__icons").html(["<div class='captcha-loader'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>"].join("\n")),m.find(".captcha-modal__icons > .captcha-image").attr("icon-hash",null),t(!0),m.trigger("refreshed",[{captcha_id:g}])}function d(a,c){var t=a.css("background-image").match(/\((.*?)\)/)[1].replace(/('|")/g,""),e=new Image;e.onload=function(){5===(_+=1)&&c&&l(c)},e.src=t,e.complete&&e.onload()}function r(a){a.addClass("captcha-opacity"),a.prepend('<div class="captcha-loader"></div>')}function l(a){a.removeClass("captcha-opacity"),a.find(".captcha-loader").remove()}var m=a(this),g=c,u=0,v=!1,f=!1,_=0;t(!1),m.on("click",".captcha-modal__icons > .captcha-image",function(c){if(!(new Date-u<=e.captchaClickDelay)&&(!e.captchaHoverDetection||v)){var t=c.pageX-a(c.target).offset().left,i=c.pageY-a(c.target).offset().top;if(t&&i){var o=a(this),n=m.find(".captcha-modal__icons");n.hasClass("captcha-opacity")||(m.trigger("selected",[{captcha_id:g}]),!0===e.enableLoadingAnimation?(r(n),setTimeout(function(){s(o)},e.loadingAnimationDelay)):s(o))}}}).on({mouseenter:function(){v||(v=!0)},mouseleave:function(){v&&(v=!1)}},m)})}})}(jQuery);